<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<meta name="description" content="">
<meta name="author" content="">
<title>Wellnowhealth</title>

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="css/bootstrap.min.css">
<!-- /Bootstrap CSS -->

<!-- Font Awesome CSS -->
<link rel="stylesheet" href="css/font-awesome.min.css">
<!-- /Font Awesome CSS -->

<!-- Custom Style CSS -->
<link rel="stylesheet" href="css/slidenav.css">
<!-- /Custom Style CSS -->

<!-- Common Style CSS -->
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/mycss.css">
<!-- /Common Style CSS -->

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
<div class="sidenav" id="mySidenav" >
    <div  class="navigation"> <a  class="closebtn" href="javascript:void(0)" onClick="closeNav()">Ã—</a>
        <div class="menu_section">
            <ul class="nav side-menu">
                <li><a  href="my-account.html">Update Info </a> </li>
                <li><a  href="current-emergencies.html">Current Emergencies </a> </li>
				<li><a  href="past-emergencies.html">Past Emergencies </a> </li>
				<li><a href="logout.html">Logout</a></li>
            </ul>
        </div>
    </div>
</div>
<div class="full-height background-layer"> 
    
    <!-----Header Start------->
    <header class="header container-fluid">
        <div class="container">
            <div class="nav-icon" onClick="openNav()"> <a id="menu_toggle"><img src="images/hamburger.png" alt=""></a> </div>
            <div class="logo"><a href="#"><img src="images/logo.png"  alt=""></a></div>
        </div>
    </header>
    <!-----Header End-------> 
    
    <!-----Main wrapper Start------->
    <div class="main-wrapper mt-5">
        <div class="container">
            <h1 class="entry-title text-white text-center">DASHBOARD</h1>
            <div class="dashbord-wrap ">
                <ul>
                    <li><a href="#" data-toggle="modal" class="reportinjury" data-target="#emergency"><img src="images/icon1.png" alt=""><br>
                       REPORT INJURY</a></li>
                    <li><a href="my-account.html"><img src="images/icon2.png" alt=""><br>
                        MANAGE ACCOUNT</a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-----Main wrapper End-------> 
    
</div>





<!-- Modal -->
<div class="modal fade" id="emergency" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content bg-primary text-white"> 
            
             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
            
            <div class="modal-body">
			
                <form id="loginuser" action="" method="post">
					<input type="hidden" name="company_id" value="0">
					<input type="hidden" name="emergency_id" value="0">
					<input type="hidden" name="add_by" value="company">
					<input type="hidden" name="manager_id" value="0">
                    <div class="clinics"></div>
					<div class="notelists"></div>
                    <div class="mb-3">
                       <label>Provider injury details <span class="note_optional">(Optional)</span>
					   <br>Please give up to 5 minutes for response</label>
					   <div>
						<textarea name="note" rows="4" cols="50" class="form-control"></textarea>
					  </div>
                    </div>
                    <div  class="submitwrap">
                        <div class="pull-left">
                            <button type="submit" class="btn btn-primary">SEND</button>
                        </div>
                        <div class="pull-right"><a class="phone-anch" href="javascript:;" id="uploadphoto1"><i class="fa fa-camera"></i></a>
						<a class="phone-anch" href="javascript:;" id="uploadphoto12"><i class="fa fa-picture-o"></i></a></div>
                    </div>
                </form>  
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="managerdetail" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content bg-primary text-white"> 
            
             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
            
            <div class="modal-body">
                 <div class="managerlists"></div>
            </div>
        </div>
    </div>
</div>
<!-- Modal  2-->
<div class="modal fade" id="calling" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content bg-primary emergency-popup"> 
            
             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
            
            <div class="modal-body">
                
                 <h2> <a href="emergancy.html"> <i class="fa fa-phone"></i> <br>
                   Calling Emergency </a> </h2>   
            </div>
        </div>
    </div>
</div>



<script src="js/jquery-3.2.1.min.js" ></script>
<script src="js/popper.min.js" ></script>
<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
<script type="text/javascript" src="js/config.js"></script>
<script src="js/bootstrap.min.js"></script> 
<script src="js/validate.js"></script>
<script>

  function openNav() {
      document.getElementById("mySidenav").style.width = "100%";
  }

  function closeNav() {
      document.getElementById("mySidenav").style.width = "0";
  }
  var uid=localStorage.getItem('Company_ID');
if(typeof uid=='undefined' || uid=='' || uid=='undefined' || uid==null){
	setTimeout(function(){
		window.location='login.html';
	},1000);
}
function getemdetail(){
	var emergency_id=jQuery('input[name="emergency_id"]').val();
	var url=siteurl+'/api/emergencies/ergencydetail';
	jQuery.ajax({  
		type: 'POST',  
		url: url,           
		dataType: 'json',  
		crossDomain: true,
		data: {id:emergency_id}, 
		beforeSend: function() {
		
		},		
		complete: function() {
		}, 
		crossDomain: true,  
		success: function(res) { 
		if(res['data'])
		{
			var html='';
			jQuery(res['data']).each(function(index){
				if(res['data'][index]['status']=='completed'){
					window.location='emergancy-detail.html?id='+emergency_id;
				}
			});
			
		}else if(res['nodata']){				
			//jQuery('.activity-map-wrap').append(res['nodata']);
		}
		
		},  
		error: function(response, d, a){
			jQuery('body .showmessage').remove();
			var html='<div class="showmessage">Server Error.</div>';
			jQuery('body').append(html);
			setTimeout(function(){jQuery('.showmessage').slideUp();},1000);
			return false; 
		}
	});
}

function notes(){
	var emergency_id=jQuery('input[name="emergency_id"]').val();
	var url=siteurl+'/api/emergencies/getsinglemsgs';
	 jQuery.ajax({  
	 type: 'POST',  
	 url: url,           
	 dataType: 'json',  
	 data: {emergency_id:emergency_id,seeby:'company'}, 
	 beforeSend: function() {
		
	 },		
	 complete: function() {
	 }, 
	 crossDomain: true,  
	 success: function(res) { 
		if(res['notes'] && jQuery.trim(res['notes'])!='')
		{
			jQuery(res['notes']).each(function(index){
				var msgg='Me: '+res['notes'][index]['note'];
				if(jQuery.trim(res['notes'][index]['manager'])!=''){
					msgg=res['notes'][index]['manager']+': '+res['notes'][index]['note'];
				}
				else{
					msgg='Me: '+res['notes'][index]['note'];
				}
				jQuery('.notelists').append('<div class="note-content">'+msgg+'</div>');
			});
			jQuery('#emergency').modal();
		
		}
		return false; 
	 },  
	 error: function(response, d, a){
		
		jQuery('body .showmessage').remove();
		var html='<div class="showmessage">Server Error.</div>';
		jQuery('body').append(html);
		setTimeout(function(){jQuery('.showmessage').slideUp();},1000);
		return false; 
	 }
			
   });
}
function startchatwithmanager(manager_id,clinic_id){
	jQuery('input[name="manager_id"]').val(manager_id);
	jQuery('#managerdetail').modal('hide');
	jQuery('textarea[name="note"]').focus();
}
function addcalls(clinic_id,$this){
	
	var $active= jQuery('.showmanagerlist_'+clinic_id+' a.activemanagercls');
	var phone=jQuery($active).attr('data-phone');
	var manager_id=jQuery($active).attr('data-id');
	
	var $parent=jQuery($active).parent('li');
	if(jQuery($parent).next('li').length){
		jQuery($active).removeClass('activemanagercls');
		jQuery($parent).next('li').find('a').addClass('activemanagercls');
	}
	else{
		jQuery($active).removeClass('activemanagercls');
		jQuery('.showmanagerlist_'+clinic_id+' li.showinfobio:first a').addClass('activemanagercls');
	}
	
	$activeagain= jQuery('.showmanagerlist_'+clinic_id+' a.activemanagercls');
	var phone2=jQuery($activeagain).attr('data-phone');
	jQuery($this).attr('href','tel:'+phone2);
	
	var url=siteurl+'/api/emergencies/addemergencyphonecall';
	setTimeout(function(){
	jQuery.ajax({  
		type: 'POST',  
		url: url,           
		data: {phone:phone,manager_id:manager_id,clinic_id:clinic_id,uid:uid}, 
		beforeSend: function() {
			
		},		
		complete: function() {
		}, 
		crossDomain: true,  
		success: function(res) { 
			
		},  
		error: function(response, d, a){
			//alert(JSON.stringify(response));
			/*jQuery('body .showmessage').remove();
			var html='<div class="showmessage">Server Error.</div>';
			jQuery('body').append(html);
			setTimeout(function(){jQuery('.showmessage').slideUp();},1000);
			return false; */
		}
	});
	},2000);
}
function checkseenmsg(){
	var seenmsgs=localStorage.getItem('seenmsgs');
	var seenmsgs_ids='';
	if(typeof seenmsgs!='undefined' && seenmsgs!='' && seenmsgs!=null){
		seenmsgs_ids=seenmsgs;
	}
	var emergency_id=jQuery('#loginuser input[name="emergency_id"]').val();
	if(emergency_id!='' && emergency_id!='0'){
		var url=siteurl+'/api/emergencies/checkseenmsgs';
		jQuery.ajax({  
		 type: 'POST',  
		 url: url,           
		 dataType: 'json',  
		 data: {seenmsgs_ids:seenmsgs_ids,emergency_id:emergency_id,seeby:'manager'}, 
		 beforeSend: function() {
			
		 },		
		 complete: function() {
		 }, 
		 crossDomain: true,  
		 success: function(res) { 
			if(res['seenids']){
				jQuery(res['seenids']).each(function(index){
					jQuery('.seen_'+res['seenids'][index]['em_msg_id']).removeClass('notseenmsg');
					jQuery('.seen_'+res['seenids'][index]['em_msg_id']).addClass('seenmsg');
				});
				if(jQuery('.notelists .note-content .notseenmsg').hasClass('emergencystart')){
					jQuery('.notelists .note-content .emergencystart').removeClass('notseenmsg');
					jQuery('.notelists .note-content .emergencystart').addClass('seenmsg');
				}
			}
		 },  
		 error: function(response, d, a){
			
			jQuery('body .showmessage').remove();
			var html='<div class="showmessage">Server Error.</div>';
			jQuery('body').append(html);
			setTimeout(function(){jQuery('.showmessage').slideUp();},1000);
			return false; 
		 }
				
	   });
	 }
}
jQuery(document).ready(function(){
	jQuery('#loginuser').validate();
	jQuery('input[name="company_id"]').val(uid);
	var url=siteurl+'/api/emergencies/clinics';
	jQuery.ajax({  
	 type: 'POST',  
	 url: url,           
	 dataType: 'json',  
	 data: {}, 
	 beforeSend: function() {
		
	 },		
	 complete: function() {
	 }, 
	 crossDomain: true,  
	 success: function(res) { 
		if(res['clinics'])
		{
			var html='<ul>';
			jQuery(res['clinics']).each(function(index){
				html+='<li><input type="radio" name="clinic_id" value="'+res['clinics'][index]['id']+'" /> '+res['clinics'][index]['name']+' ('+res['clinics'][index]['address']+')';			
				var clnid=res['clinics'][index]['id'];
				var manarray=new Array();
				var phn=res['clinics'][index]['phone'];
				if(typeof res['clinics'][index]['managers']!='undefined'){
					var manager=res['clinics'][index]['managers'];
					html+='<ul class="showmanagerlist showmanagerlist_'+clnid+'" style="display:none;"><li>Click on provider name for bio.</li>';
					jQuery(manager).each(function(index2){
						var activemanagercls='';
						if(index2=='0'){
							phn=manager[index2]['phone'];
							activemanagercls=' activemanagercls';
						}
						var activestatus='&nbsp;&nbsp;<span class="currentoffline">Offline</span>';
						if(manager[index2]['loggedin']=='1'){activestatus='&nbsp;&nbsp;<span class="currentonline">Online</span>';}
						html+='<li class="showinfobio"><a href="javascript:;" class="showmanagerdetail'+activemanagercls+'" data-id="'+manager[index2]['id']+'" data-fname="'+manager[index2]['fname']+'" data-email="'+manager[index2]['email']+'" data-phone="'+manager[index2]['phone']+'" data-bioinfo="'+manager[index2]['bioinfo']+'" data-image="'+manager[index2]['image']+'" data-clinic_id="'+manager[index2]['clinic_id']+'">'+manager[index2]['fname']+'</a>'+activestatus+'</li>';
						manarray[index2]={'phone':manager[index2]['phone'],'id':manager[index2]['id']};
						//var mnphones=;
						
						//managesphone.push(mnphones);
					});
					html+='</ul>';
				}
				//alert(managesphone);
				
				if(jQuery.trim(phn)!='' && phn!='undefined'){
					html+='<ul class="emcall"><li><h2 class="emcalling"><i class="fa fa-phone"></i><a href="tel:'+phn+'" onclick="addcalls('+clnid+', this)">Call Emergency</a></h2></li></ul>';
				}
				html+='</li>';
				
			});
			html+='<ul>';
			jQuery('.clinics').html(html);
			jQuery('.clinics input:first').attr('checked',true);
			jQuery('.clinics input:first').prop('checked',true);
			jQuery('.clinics li:first ul').show();
			
			jQuery('.showmanagerdetail').click(function(){
				var ht='<ul>';
				var img=jQuery(this).attr('data-image');
				if(jQuery.trim(img)!=''){
					ht+='<li><img src="'+img+'" alt="" style="max-height:100px; float:left; margin:0 5px 5px 0;" />'+jQuery(this).attr('data-bioinfo')+'</li>';
				}
				else{
					ht+='<li><span>'+jQuery(this).attr('data-bioinfo')+'</span></li>';
				}
				/*ht+='<li><label>Phone: </label> <span>'+jQuery(this).attr('data-phone')+'</span></li>';
				ht+='<li><label>Email: </label> <span>'+jQuery(this).attr('data-email')+'</span></li>';*/
				/*if(jQuery(this).attr('data-phone')!=''){
					ht+='<li><h2 class="emcalling"><i class="fa fa-phone"></i> <a href="tel:'+jQuery(this).attr('data-phone')+'" onclick="addcalls(\''+jQuery(this).attr('data-phone')+'\','+jQuery(this).attr('data-id')+','+jQuery(this).attr('data-clinic_id')+')">Call Emergency</a></h2><h2 class="emcalling"><i class="fa fa-comment"></i> <a href="javascript:;" onclick="startchatwithmanager('+jQuery(this).attr('data-id')+','+jQuery(this).attr('data-clinic_id')+')">Start Message</a></h2></li>';
				}*/
				ht+'</ul>';
				jQuery('.managerlists').html(ht);
				jQuery('#managerdetail').modal();
			});
			jQuery('input[name="clinic_id"]').change(function(){
				var $t=jQuery('input[name="clinic_id"]:checked');
				jQuery('.showmanagerlist').slideUp();
				jQuery($t).next('ul.showmanagerlist').slideDown();
			});
		}
		return false; 
	 },  
	 error: function(response, d, a){
		
		jQuery('body .showmessage').remove();
		var html='<div class="showmessage">Server Error.</div>';
		jQuery('body').append(html);
		setTimeout(function(){jQuery('.showmessage').slideUp();},1000);
		return false; 
	 }
			
   });
   jQuery('a.reportinjury').click(function(){
   		getLocation();
		jQuery('input[name="company_id"]').val(uid);
   });
   jQuery('#loginuser').submit( function(){	
		var error=false;
		jQuery('#loginuser input.required').each(function(){
			var v=jQuery(this).val();
			if(jQuery.trim(v)==''){
				jQuery(this).addClass('error');
				error=true;
			}
			else{
				jQuery(this).removeClass('error');
			}
		});
		jQuery('#loginuser textarea.required').each(function(){
			var v=jQuery(this).val();
			if(jQuery.trim(v)==''){
				jQuery(this).addClass('error');
				error=true;
			}
			else{
				jQuery(this).removeClass('error');
			}
		});
		
		var url=siteurl+'/api/emergencies/addemergency';
		if(error)
		{
			return false;
		}
		else
		{
			var msg=jQuery('#loginuser textarea[name="note"]').val();
			var emergency_id=jQuery('#loginuser input[name="emergency_id"]').val();
			if(parseInt(emergency_id)!='' && parseInt(emergency_id)>0){
				url=siteurl+'/api/emergencies/addemergencymsg';
			}
			 jQuery.ajax({  
			 type: 'POST',  
			 url: url,           
			 dataType: 'json',  
			 data: jQuery('#loginuser').serialize(), 
			 beforeSend: function() {
			 	
			 },		
			 complete: function() {
			 }, 
			 crossDomain: true,  
			 success: function(res) { 
				if(res['msg'])
				{
					var cls='';
					if(parseInt(emergency_id)==0){
						cls=' emergencystart';
					}
					jQuery('.notelists').append('<div class="note-content">Me: '+msg+'<span class="seen_'+res['emergency_id']+cls+' notseenmsg"></span></div>');
					jQuery('body .showmessage').remove();
					var html='<div class="showmessage">'+res['msg']+'</div>';
					jQuery('body').append(html);
					setTimeout(function(){jQuery('.showmessage').slideUp();},3000);
					jQuery('#loginuser textarea[name="note"]').val('');
					if(parseInt(emergency_id)==0){
						jQuery('.note_optional').remove();
						jQuery('#loginuser textarea[name="note"]').addClass('required');
						jQuery('input[name="emergency_id"]').val(res['emergency_id']);
						jQuery('.submitwrap').append('<div class="pull-right"><a href="current-emergancy-detail.html?id='+res['emergency_id']+'" class="locationlink">Location on Map</a></div>');
					}
					if(typeof inter!='undefined'){
						clearInterval(inter);
					}
					var inter=setInterval(notes,10000);
					setInterval(getemdetail,5000);
					//jQuery('#loginuser')[0].reset();
					//jQuery('#emergency').modal('hide');
					setInterval(checkseenmsg,6000);
				
				}else if(res['errors']){				
					jQuery('body .showmessage').remove();
					var html='<div class="showmessage">'+res['error']+'</div>';
					jQuery('body').append(html);
					setTimeout(function(){jQuery('.showmessage').slideUp();},3000);
				}
				else
				{
					alert('Server error');
				}
				return false; 
			 },  
			 error: function(response, d, a){
				
				jQuery('body .showmessage').remove();
				var html='<div class="showmessage">Server Error.</div>';
				jQuery('body').append(html);
				setTimeout(function(){jQuery('.showmessage').slideUp();},1000);
				return false; 
			 }
			        
		   });
		 }	
		 return false;   
	});
   //getLocation();
});
var platform='';
function fail(error) {
	jQuery('body .showmessage').remove();
	var html='<div class="showmessage" style="width:100%">Uploading error: Code = ' + error.code+', upload error source ' + error.source+', upload error target ' + error.target+'</div>';
	jQuery('body').append(html);
	setTimeout(function(){jQuery('.showmessage').slideUp();},3000);
}
function uploadgallerypic() {
	navigator.camera.getPicture(function(f) {
        var filetrasfer=f;
		if(filetrasfer!=''){
			//jQuery('.submitwrap img.justloading').remove();
			//jQuery('.submitwrap').append('<img src="images/ajax-loader.gif" class="justloading" />');
			jQuery('body .showmessage').remove();
			var html='<div class="showmessage">Please wait while uploading image...</div>';
			jQuery('body').append(html);
			var company_id=jQuery('input[name="company_id"]').val();
			var emergency_id=jQuery('input[name="emergency_id"]').val();
			var add_by=jQuery('input[name="add_by"]').val();
			var manager_id=jQuery('input[name="manager_id"]').val();
			var clinic_id=jQuery('input[name="clinic_id"]').val();
			
			resolveLocalFileSystemURL(filetrasfer, function(entry) {
			var filetrasfer2= entry.toURL();
			
			var uri = encodeURI(siteurl+'/api/emergencies/saveemergencyimg?company_id='+company_id+'&emergency_id='+emergency_id+'&add_by='+add_by+'&manager_id='+manager_id+'&clinic_id='+clinic_id);
			if(parseInt(emergency_id)!='' && parseInt(emergency_id)>0){
				uri = encodeURI(siteurl+'/api/emergencies/addemergencyimgmsg?company_id='+company_id+'&emergency_id='+emergency_id+'&add_by='+add_by+'&manager_id='+manager_id+'&clinic_id='+clinic_id);
			}
			var options = new FileUploadOptions();
			options.fileKey="file";
			options.fileName=filetrasfer2.substr(filetrasfer2.lastIndexOf('/')+1);
			//options.mimeType="image/jpeg";
			var params = new Object();
			 params.value1 = "test";
			 params.value2 = "param";
			 options.params = params;
			 options.chunkedMode = false;
			var headers={'headerParam':'headerValue'};
			options.headers = headers;
			
			var ft = new FileTransfer();
			
			var t=ft.upload(filetrasfer2, uri, function(r){
					//jQuery('.submitwrap img.justloading').remove();
					var cntents=r.response.split('||emg||');
					jQuery('.notelists').append('<div class="note-content">'+cntents[0]);
					jQuery('body .showmessage').remove();
					var html='<div class="showmessage">'+cntents[2]+'</div>';
					jQuery('body').append(html);
					setTimeout(function(){jQuery('.showmessage').slideUp();},3000);
					if(parseInt(emergency_id)==0){
						jQuery('input[name="emergency_id"]').val(cntents[1]);
						jQuery('.submitwrap').append('<div class="pull-right"><a href="current-emergancy-detail.html?id='+cntents[1]+'" class="locationlink">Location on Map</a></div>');
					}
					if(typeof inter!='undefined'){
						clearInterval(inter);
					}
					var inter=setInterval(notes,10000);
					setInterval(getemdetail,5000);
					setInterval(checkseenmsg,6000);
						
			}, fail, options);
			});
		}
    }, function(e) {
    }, { 
        quality: 1,
        sourceType: Camera.PictureSourceType.PHOTOLIBRARY,
        destinationType: Camera.DestinationType.FILE_URI
    });
    
}
function uploadcamerapic() {
	var captureSuccess = function(mediaFiles) {
		var i, path, len;
		for (i = 0, len = mediaFiles.length; i < len; i += 1) {
			path = mediaFiles[i].fullPath;
			if(platform!='Android'){
				var htt = "file:///";
				if(path.indexOf(htt) == '-1'){path=htt+path;}
			}
			var job_id=gup('job_id');
			var filetrasfer=path;
			
			if(filetrasfer!=''){
				//jQuery('.submitwrap img.justloading').remove();
				jQuery('body .showmessage').remove();
				var html='<div class="showmessage">Please wait while uploading image...</div>';
				jQuery('body').append(html);
				var company_id=jQuery('input[name="company_id"]').val();
				var emergency_id=jQuery('input[name="emergency_id"]').val();
				var add_by=jQuery('input[name="add_by"]').val();
				var manager_id=jQuery('input[name="manager_id"]').val();
				var clinic_id=jQuery('input[name="clinic_id"]').val();	
				resolveLocalFileSystemURL(filetrasfer, function(entry) {
				var filetrasfer2= entry.toURL();
				var uri = encodeURI(siteurl+'/api/emergencies/saveemergencyimg?company_id='+company_id+'&emergency_id='+emergency_id+'&add_by='+add_by+'&manager_id='+manager_id+'&clinic_id='+clinic_id);
				if(parseInt(emergency_id)!='' && parseInt(emergency_id)>0){
					uri = encodeURI(siteurl+'/api/emergencies/addemergencyimgmsg?company_id='+company_id+'&emergency_id='+emergency_id+'&add_by='+add_by+'&manager_id='+manager_id+'&clinic_id='+clinic_id);
				}
				var options = new FileUploadOptions();
				options.fileKey="file";
				options.fileName=filetrasfer2.substr(filetrasfer2.lastIndexOf('/')+1);
				//options.mimeType="image/jpeg";
				var params = new Object();
				 params.value1 = "test";
				 params.value2 = "param";
				 options.params = params;
				 options.chunkedMode = false;
				var headers={'headerParam':'headerValue'};
				options.headers = headers;
				
				var ft = new FileTransfer();
				
				var t=ft.upload(filetrasfer2, uri, function(r){
					//jQuery('.submitwrap img.justloading').remove();
					var cntents=r.response.split('||emg||');
					jQuery('.notelists').append('<div class="note-content">'+cntents[0]);
					jQuery('body .showmessage').remove();
					var html='<div class="showmessage">'+cntents[2]+'</div>';
					jQuery('body').append(html);
					setTimeout(function(){jQuery('.showmessage').slideUp();},3000);
					if(parseInt(emergency_id)==0){
						jQuery('input[name="emergency_id"]').val(cntents[1]);
						jQuery('.submitwrap').append('<div class="pull-right"><a href="current-emergancy-detail.html?id='+cntents[1]+'" class="locationlink">Location on Map</a></div>');
					}
					if(typeof inter!='undefined'){
						clearInterval(inter);
					}
					var inter=setInterval(notes,10000);
					setInterval(getemdetail,5000);
					setInterval(checkseenmsg,6000);
				}, fail, options);
				});
			}
		}
	};
	// capture error callback
	var captureError = function(error) {
		navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
	};
	navigator.device.capture.captureImage(captureSuccess, captureError, {limit:5});
    
    
}
document.addEventListener("deviceready", uploadpic, false);
function uploadpic() {
	platform=device.platform;
	jQuery("#uploadphoto1").on("touchend", uploadcamerapic);
	jQuery("#uploadphoto12").on("touchend", uploadgallerypic);
}
</script>
</body>
</html>
